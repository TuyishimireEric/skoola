<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ER Diagram - Chen Notation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.6.1/mermaid.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #333;
        }
        #mermaid-diagram {
            width: 100%;
            overflow: auto;
        }
        .btn-container {
            text-align: center;
            margin-top: 20px;
        }
        .export-btn {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .export-btn:hover {
            background-color: #45a049;
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="mermaid-diagram"></div>
        <div class="btn-container">
            <button id="export-btn" class="export-btn">Export to SVG</button>
        </div>
    </div>

    <script>
        // Initialize Mermaid
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose',
            er: {
                diagramPadding: 20,
                layoutDirection: 'TB',
                minEntityWidth: 100,
                minEntityHeight: 75,
                entityPadding: 15,
                stroke: 'gray',
                fill: 'honeydew',
                fontSize: 12
            }
        });

        // ER Diagram definition
        const diagram = `
        erDiagram
            User {
                uuid Id PK
                varchar FullName
                varchar Email UK
                varchar ParentName
                varchar ParentEmail
                varchar Phone
                varchar Gender
                varchar ImageUrl
                date DateOfBirth
                jsonb Address
                varchar Role
                boolean IsVerified
                varchar Password
                varchar GoogleId UK
                varchar LoginCode
                varchar Status
                uuid CurrentClass FK
                timestamp LastLogin
                timestamp CreatedOn
                timestamp UpdatedOn
            }

            Course {
                uuid Id PK
                text Title
                text Description
                text Instuctions
                text ImageUrl
                text TutorialVideo
                uuid ClassId FK
                text Subject
                timestamp CreatedOn
                timestamp UpdatedOn
                uuid CreatedBy FK
                uuid UpdatedBy FK
                text Prompt
                enum Status
                timestamp StartDate
                timestamp EndDate
                integer Duration
                integer PassScore
                integer Retakes
                text Tags
                boolean SingleResponse
                integer QuestionsPerPage
                integer NumberOfQuestions
                integer NumberOfLevels
                enum Type
            }

            Classes {
                uuid Id PK
                varchar Name UK
                text Description
                uuid TeacherId FK
                timestamp CreatedOn
                timestamp UpdatedOn
            }

            StudentClass {
                uuid Id PK
                uuid StudentId FK
                varchar Status
                uuid ClassId FK
                timestamp StartedOn
                timestamp EndedOn
                timestamp CreatedOn
                timestamp UpdatedOn
            }

            StudentGame {
                uuid Id PK
                uuid StudentId FK
                uuid GameId FK
                numeric Score
                jsonb MissedQuestions
                timestamp StartedOn
                timestamp CompletedOn
            }

            User ||--o{ Course : "creates"
            User ||--o{ StudentGame : "takes"
            User ||--o{ StudentClass : "enrolls"
            User ||--o{ Classes : "teaches"
            Classes ||--o{ Course : "contains"
            Classes ||--o{ StudentClass : "has"
            Course ||--o{ StudentGame : "taken by"
        `;

        // Render the diagram
        const element = document.getElementById("mermaid-diagram");
        mermaid.render("mermaid-svg", diagram).then(result => {
            element.innerHTML = result.svg;
        });

        // Export to SVG functionality
        document.getElementById("export-btn").addEventListener("click", function() {
            const svgElement = document.querySelector("#mermaid-diagram svg");
            if (!svgElement) {
                alert("SVG diagram not loaded yet!");
                return;
            }

            const serializer = new XMLSerializer();
            const svgData = serializer.serializeToString(svgElement);
            const blob = new Blob([svgData], { type: "image/svg+xml" });

            // Create download link
            const link = document.createElement("a");
            link.download = "er-diagram.svg";
            link.href = URL.createObjectURL(blob);
            link.click();
            URL.revokeObjectURL(link.href);
        });
    </script>
</body>
</html>
